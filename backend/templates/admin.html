<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>לוח מנהל</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="mb-4 text-center">לוח מנהל – ניהול כיתות ותורנים</h2>

    <div class="mb-4">
        <h4>כיתות</h4>
        <table class="table table-bordered bg-white shadow-sm">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>שם הכיתה</th>
                </tr>
            </thead>
            <tbody id="classes-table">
                <!-- Classes loaded via JS -->
            </tbody>
        </table>
        <button class="btn btn-success" onclick="addClass()">הוספת כיתה</button>
    </div>

    <div class="mb-4">
        <h4>תורנים</h4>
        <table class="table table-bordered bg-white shadow-sm">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>שם</th>
                    <th>אימייל</th>
                    <th>כיתה</th>
                </tr>
            </thead>
            <tbody id="users-table">
                <!-- Users loaded via JS -->
            </tbody>
        </table>
    </div>
</div>

<script>
async function loadUsers() {
    const res = await fetch("/users");
    const users = await res.json();
    const tbody = document.getElementById("users-table");
    tbody.innerHTML = "";
    users.forEach(u => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${u.id}</td><td>${u.name}</td><td>${u.email}</td><td>${u.class_id || ''}</td>`;
        tbody.appendChild(tr);
    });
}

async function loadClasses() {
    const res = await fetch("/classes");
    const classes = await res.json();
    const tbody = document.getElementById("classes-table");
    tbody.innerHTML = "";
    classes.forEach(c => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${c.id}</td><td>${c.name}</td>`;
        tbody.appendChild(tr);
    });
}

function addClass() {
    const name = prompt("הכנס שם כיתה חדשה:");
    if(!name) return;
    fetch("/add_class", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({name: name, admin_id:1})
    }).then(()=>loadClasses());
}

loadUsers();
loadClasses();
</script>
</body>
</html>
